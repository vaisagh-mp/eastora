{% extends 'adminpanel/base.html' %}
{% load static %}
{% block content %}

<div class="container">
    <div class="row justify-content-center">
        <div class="add-catgry-col">
            <div class="add-catgry-card">
                <h3 class="add-catgry-title mb-4">Update Category</h3>
                <form class="add-catgry-form" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}

                    <!-- Category Name -->
                    <div class="mb-3">
                        <label for="categoryName" class="add-catgry-label">Category Name</label>
                        <input type="text" name="categoryName" id="categoryName" class="add-catgry-input"
                            placeholder="Enter category name" value="{{ category.name }}" required>
                    </div>

                    <!-- Parent Category -->
                    <div class="mb-3">
                        <label for="parentCategory" class="add-catgry-label">Parent Category</label>
                        <select id="parentCategory" name="parentCategory" class="add-catgry-select">
                            <option value="">None</option>
                            {% for cat in parent_categories %}
                                <option value="{{ cat.id }}"
                                    {% if cat.id|stringformat:"s" == selected_parent_id|stringformat:"s" %}selected{% endif %}>
                                    {{ cat.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Parent Choice -->
                    <div class="mb-3">
                        <label for="parentChoice" class="add-catgry-label">Parent Choice</label>
                        <select id="parentChoice" name="parentChoice" class="add-catgry-select">
                            <option value="">None</option>
                            {% for value, label in parent_choices %}
                            <option value="{{ value }}" {% if category.parent_choice == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    

                    <!-- Banner Image Desktop -->
                    <div class="mb-3">
                        <label class="add-catgry-label">Category Banner Image (Desktop)</label>
                        <input type="file" id="bannerImageDesktop" name="bannerImage" class="add-catgry-input d-none" accept="image/*">
                        <label for="bannerImageDesktop" class="add-catgry-dropzone" id="bannerDropzoneDesktop">
                            {% if category.banner_image_desktop %}
                                <img id="bannerImagePreviewDesktop" src="{{ category.banner_image_desktop.url }}" alt="Current Desktop Banner" style="display:block; max-height:120px;">
                            {% else %}
                                <img id="bannerImagePreviewDesktop" src="" alt="Preview" style="display:none; max-height:120px;">
                            {% endif %}
                            <span id="bannerImageTextDesktop">Drag & drop or Select file</span>
                        </label>
                    </div>
                    
                    <!-- Banner Image Mobile -->
                    <div class="mb-3">
                        <label class="add-catgry-label">Category Banner Image (Mobile)</label>
                        <input type="file" id="bannerImageMobile" name="bannerImageMobile" class="add-catgry-input d-none" accept="image/*">
                        <label for="bannerImageMobile" class="add-catgry-dropzone" id="bannerDropzoneMobile">
                            {% if category.banner_image_mobile %}
                                <img id="bannerImagePreviewMobile" src="{{ category.banner_image_mobile.url }}" alt="Current Mobile Banner" style="display:block; max-height:120px;">
                            {% else %}
                                <img id="bannerImagePreviewMobile" src="" alt="Preview" style="display:none; max-height:120px;">
                            {% endif %}
                            <span id="bannerImageTextMobile">Drag & drop or Select file</span>
                        </label>
                    </div>
                    
                    <!-- Card Image -->
                    <div class="mb-3">
                        <label class="add-catgry-label">Card Image</label>
                        <input type="file" id="cardImage" name="card_image" class="add-catgry-input d-none" accept="image/*">
                        <label for="cardImage" class="add-catgry-dropzone" id="cardDropzone">
                            {% if category.card_image %}
                                <img id="cardImagePreview" src="{{ category.card_image.url }}" alt="Current Card Image" style="display:block; max-height:120px;">
                            {% else %}
                                <img id="cardImagePreview" src="" alt="Preview" style="display:none; max-height:120px;">
                            {% endif %}
                            <span id="cardImageText">Drag & drop or Select file</span>
                        </label>
                    </div>
                    
                    
                    <!-- Short Description -->
                    <div class="mb-3">
                        <label for="shortDesc" class="add-catgry-label">Short Description</label>
                        <input type="text" name="shortDesc" id="shortDesc" class="add-catgry-input"
                            value="{{ category.short_description|safe }}" placeholder="Brief description">
                    </div>

                    <!-- Long Description -->
                    <div class="mb-4">
                        <label for="longDesc" class="add-catgry-label">Long Description</label>
                        <textarea name="longDesc" id="longDesc" rows="5" class="add-catgry-textarea"
                            placeholder="Write full description here...">{{ category.long_description }}</textarea>
                    </div>

                    <!-- Tittle Name One -->
                    <div class="mb-3">
                        <label for="tittlefirst" class="add-catgry-label">Tittle Name One</label>
                        <input type="text" name="tittlefirst" id="tittlefirst" class="add-catgry-input"
                            placeholder="Enter title first" value="{{ category.tittle_first }}" required>
                    </div>

                    <!-- Content 1 -->
                    <div class="mb-4">
                        <label for="contentfir" class="add-catgry-label">Content 1 </label>
                        <textarea name="contentfir" id="Content1" rows="5" class="add-catgry-textarea"
                            placeholder="Write full description here...">{{ category.content_first }}</textarea>
                    </div>

                    <!-- Tittle Name two -->
                    <div class="mb-3">
                        <label for="tittlesecond" class="add-catgry-label">Tittle Name two</label>
                        <input type="text" name="tittlesecond" id="tittlesecond" class="add-catgry-input"
                            placeholder="Enter title second" value="{{ category.tittle_second }}" required>
                    </div>

                    <!-- Content 2 -->
                    <div class="mb-4">
                        <label for="contentsec" class="add-catgry-label">Content 2 </label>
                        <textarea name="contentsec" id="Content2" rows="5" class="add-catgry-textarea"
                            placeholder="Write full description here...">{{ category.content_second }}</textarea>
                    </div>

                    <!-- Recommended -->
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="recomanded" name="recomanded" 
                        {% if category.is_featured %}checked{% endif %}>
                        <label class="form-check-label add-catgry-label" for="recomanded">Recommended</label>
                    </div>

                    <!-- Submit -->
                    <div class="text-center">
                        <button type="submit" class="add-catgry-btn">Update Category</button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>


<!-- <script>
        const dropzone = document.getElementById('bannerDropzone');
        const input = document.getElementById('bannerImage');
        const imageText = document.getElementById('bannerImageText');
        const imagePreview = document.getElementById('bannerImagePreview');

        // Highlight on drag
        ['dragenter', 'dragover'].forEach(evt => {
            dropzone.addEventListener(evt, e => {
                e.preventDefault();
                dropzone.classList.add('dragover');
            });
        });

        // Remove highlight on dragleave/drop
        ['dragleave', 'drop'].forEach(evt => {
            dropzone.addEventListener(evt, e => {
                e.preventDefault();
                dropzone.classList.remove('dragover');
            });
        });

        // Open file dialog on click
        dropzone.addEventListener('click', () => input.click());

        // When file is dropped
        dropzone.addEventListener('drop', e => {
            e.preventDefault();
            input.files = e.dataTransfer.files;
            handleImagePreview(input.files[0]);
        });

        // When file is selected manually
        input.addEventListener('change', () => {
            handleImagePreview(input.files[0]);
        });

        function handleImagePreview(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    imageText.innerHTML = `<strong>${file.name}</strong> selected.`;
                };
                reader.readAsDataURL(file);
            } else {
                imageText.innerHTML = 'Invalid file type. Please select an image.';
                imagePreview.style.display = 'none';
            }
        }
    </script> -->


    <script>
function setupImageUploader(inputId, dropzoneId, previewId, textId) {
    const dropzone = document.getElementById(dropzoneId);
    const input = document.getElementById(inputId);
    const imageText = document.getElementById(textId);
    const imagePreview = document.getElementById(previewId);

    ['dragenter', 'dragover'].forEach(evt => {
        dropzone.addEventListener(evt, e => {
            e.preventDefault();
            dropzone.classList.add('dragover');
        });
    });

    ['dragleave', 'drop'].forEach(evt => {
        dropzone.addEventListener(evt, e => {
            e.preventDefault();
            dropzone.classList.remove('dragover');
        });
    });

    dropzone.addEventListener('click', () => input.click());

    dropzone.addEventListener('drop', e => {
        e.preventDefault();
        input.files = e.dataTransfer.files;
        handleImagePreview(input.files[0]);
    });

    input.addEventListener('change', () => {
        handleImagePreview(input.files[0]);
    });

    function handleImagePreview(file) {
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function (e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                imageText.innerHTML = `<strong>${file.name}</strong> selected.`;
            };
            reader.readAsDataURL(file);
        } else {
            imageText.innerHTML = 'Invalid file type. Please select an image.';
            imagePreview.style.display = 'none';
        }
    }
}

// Init for desktop, mobile, and card
setupImageUploader('bannerImageDesktop', 'bannerDropzoneDesktop', 'bannerImagePreviewDesktop', 'bannerImageTextDesktop');
setupImageUploader('bannerImageMobile', 'bannerDropzoneMobile', 'bannerImagePreviewMobile', 'bannerImageTextMobile');
setupImageUploader('cardImage', 'cardDropzone', 'cardImagePreview', 'cardImageText');
</script>


<script src="https://cdn.ckeditor.com/ckeditor5/41.1.0/classic/ckeditor.js"></script>
<!-- CK Text Editor -->
 <script>
  ClassicEditor
    .create(document.querySelector('#longDescriptionEditor'))
    .then(editor => {
      editor.ui.view.editable.element.style.height = '250px';
    })
    .catch(error => {
      console.error('There was a problem initializing CKEditor:', error);
 });
</script>

 <script>
  ClassicEditor
    .create(document.querySelector('#Content1'))
    .then(editor => {
      editor.ui.view.editable.element.style.height = '250px';
    })
    .catch(error => {
      console.error('There was a problem initializing CKEditor:', error);
 });
</script>

 <script>
  ClassicEditor
    .create(document.querySelector('#Content2'))
    .then(editor => {
      editor.ui.view.editable.element.style.height = '250px';
    })
    .catch(error => {
      console.error('There was a problem initializing CKEditor:', error);
 });
</script>
{% endblock %}